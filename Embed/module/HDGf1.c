#include "HDGf1.h"

#define HDG_DISP_OFF	0xAE //1.0 关显示
#define HDG_DISP_ON		0xAF //1.1 开显示

#define HDG_START_LINE_SET	   //2 01+display start address 显示时读取内存开始地址，默认为从0开始
#define HDG_PAGE_ADDR      0xB0//3	 页地址的高4位前缀1011
#define HDG_COLUMN_ADDR_H  0x10//4.0 列地址高位的高4位前缀0001
#define HDG_COLUNM_ADDR_L  0x00//4.1 列地址低位的高4位前缀0000
//...
#define HDG_ADC_SELECT_NORMAL  0xA0//8.0 设置内存与显示通道对应为正常（原点在右上角）
#define HDG_ADC_SELECT_REVERSE 0xA1//8.1 设置内存与显示通道对应为相反（原点在左上角）

#define HDG_DISP_NORMAL  0xA6 //9.0 正常
#define HDG_DISP_REVERSE 0xA7 //9.1 反色

#define HDG_DISP_ALL_ON 0xA4 //10.0 
#define HDG_DISP_ALL	0xA5 //10.1 

#define HDG_INNER_RESET 0xE2 //14:Internal Reset

uint8_t ascii[128][8] = {//ascii码表
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x2e,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x04,0x00,0x04,0x00,0x00,0x00,0x00,},
{0x10,0x3e,0x38,0x1e,0x00,0x00,0x00,0x00,},
{0x00,0x6e,0x16,0x00,0x00,0x00,0x00,0x00,},
{0x0e,0x0a,0x3e,0x06,0x30,0x30,0x00,0x00,},
{0x00,0x3e,0x3a,0x36,0x20,0x00,0x00,0x00,},
{0x06,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x3c,0x42,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x42,0x3c,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x0e,0x04,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x08,0x1c,0x08,0x00,0x00,0x00,0x00,},
{0x20,0x20,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x70,0x0e,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x1c,0x22,0x1c,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x22,0x3e,0x20,0x00,0x00,0x00,0x00,},
{0x36,0x2a,0x26,0x00,0x00,0x00,0x00,0x00,},
{0x22,0x2a,0x36,0x00,0x00,0x00,0x00,0x00,},
{0x18,0x34,0x3e,0x30,0x00,0x00,0x00,0x00,},
{0x26,0x26,0x3e,0x00,0x00,0x00,0x00,0x00,},
{0x3c,0x26,0x3e,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x02,0x3e,0x00,0x00,0x00,0x00,0x00,},
{0x36,0x2a,0x36,0x00,0x00,0x00,0x00,0x00,},
{0x2e,0x2a,0x1e,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x28,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x20,0x28,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x18,0x1c,0x26,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x14,0x14,0x14,0x14,0x00,0x00,0x00,},
{0x36,0x1c,0x18,0x00,0x00,0x00,0x00,0x00,},
{0x04,0x2a,0x0e,0x00,0x00,0x00,0x00,0x00,},
{0x1c,0x3a,0x3a,0x3a,0x1c,0x00,0x00,0x00,},
{0x3c,0x02,0x02,0x3c,0x00,0x00,0x00,0x00,},
{0x3e,0x02,0x2a,0x36,0x00,0x00,0x00,0x00,},
{0x1c,0x22,0x22,0x36,0x1c,0x00,0x00,0x00,},
{0x3e,0x02,0x22,0x22,0x1c,0x00,0x00,0x00,},
{0x3e,0x2a,0x2a,0x00,0x00,0x00,0x00,0x00,},
{0x3c,0x06,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x1c,0x22,0x2e,0x18,0x00,0x00,0x00,0x00,},
{0x3e,0x00,0x00,0x3e,0x00,0x00,0x00,0x00,},
{0x3e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x3e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x3e,0x00,0x1c,0x36,0x22,0x00,0x00,0x00,},
{0x3e,0x20,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x3e,0x02,0x3c,0x02,0x3e,0x00,0x00,0x00,},
{0x3c,0x02,0x02,0x3c,0x00,0x00,0x00,0x00,},
{0x1c,0x22,0x22,0x22,0x1c,0x00,0x00,0x00,},
{0x3c,0x02,0x1a,0x1c,0x00,0x00,0x00,0x00,},
{0x1c,0x32,0x32,0x32,0x1c,0x00,0x00,0x00,},
{0x3e,0x02,0x3a,0x3e,0x00,0x00,0x00,0x00,},
{0x2c,0x2a,0x1e,0x00,0x00,0x00,0x00,0x00,},
{0x02,0x3e,0x02,0x02,0x00,0x00,0x00,0x00,},
{0x3e,0x20,0x20,0x3e,0x00,0x00,0x00,0x00,},
{0x06,0x3c,0x0e,0x02,0x00,0x00,0x00,0x00,},
{0x3e,0x20,0x3e,0x20,0x3e,0x00,0x00,0x00,},
{0x26,0x1c,0x3e,0x22,0x00,0x00,0x00,0x00,},
{0x06,0x3c,0x06,0x00,0x00,0x00,0x00,0x00,},
{0x22,0x3e,0x3e,0x22,0x00,0x00,0x00,0x00,},
{0x7e,0x42,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x0e,0x70,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x42,0x7e,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x08,0x06,0x0e,0x00,0x00,0x00,0x00,0x00,},
{0x40,0x40,0x40,0x40,0x00,0x00,0x00,0x00,},
{0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x30,0x28,0x08,0x38,0x00,0x00,0x00,0x00,},
{0x3e,0x20,0x28,0x38,0x00,0x00,0x00,0x00,},
{0x38,0x28,0x28,0x10,0x00,0x00,0x00,0x00,},
{0x18,0x28,0x20,0x3e,0x00,0x00,0x00,0x00,},
{0x30,0x38,0x28,0x08,0x00,0x00,0x00,0x00,},
{0x3e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x30,0x68,0x48,0x78,0x00,0x00,0x00,0x00,},
{0x3e,0x08,0x38,0x00,0x00,0x00,0x00,0x00,},
{0x3a,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x40,0x7a,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x3e,0x00,0x38,0x28,0x00,0x00,0x00,0x00,},
{0x3e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x38,0x08,0x38,0x08,0x38,0x00,0x00,0x00,},
{0x38,0x08,0x38,0x00,0x00,0x00,0x00,0x00,},
{0x18,0x28,0x28,0x38,0x00,0x00,0x00,0x00,},
{0x78,0x08,0x28,0x38,0x00,0x00,0x00,0x00,},
{0x38,0x28,0x08,0x78,0x00,0x00,0x00,0x00,},
{0x38,0x08,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x20,0x38,0x08,0x00,0x00,0x00,0x00,0x00,},
{0x1e,0x24,0x00,0x00,0x00,0x00,0x00,0x00,},//{0x1e,0x20,0x00,0x00,0x00,0x00,0x00,0x00,}修正了字体
{0x38,0x20,0x38,0x00,0x00,0x00,0x00,0x00,},
{0x08,0x38,0x08,0x00,0x00,0x00,0x00,0x00,},
{0x38,0x20,0x38,0x20,0x38,0x00,0x00,0x00,},
{0x38,0x10,0x38,0x00,0x00,0x00,0x00,0x00,},
{0x38,0x60,0x78,0x00,0x00,0x00,0x00,0x00,},
{0x28,0x38,0x28,0x00,0x00,0x00,0x00,0x00,},
{0x10,0x7e,0x02,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x7e,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x42,0x7e,0x00,0x00,0x00,0x00,0x00,0x00,},
{0x00,0x03,0x02,0x03,0x00,0x00,0x00,0x00},
};

static void HDG_write_cmd(uint8_t dat)
{
	A0_CLR;
	CS_SET;
	HAL_SPI_Transmit(&hspi1,&dat,1,0);
	CS_CLR;
}

static void HDG_write_constant_data(uint8_t *dat,uint8_t num)//连续传输多个字节速度较快
{
	A0_SET;
	CS_SET;
	HAL_SPI_Transmit(&hspi1,dat,num,0);
	CS_CLR;
}

static void HDG_reset(void)
{
	//硬复位
	RES_CLR;
	delay_ms(20);
	RES_SET;
	//软复位
	HDG_write_cmd(HDG_INNER_RESET);
	delay_ms(20);
}

/* @name:HDG_Init(void)
 * @func:初始化LCD屏幕
**/
void HDG_Init(void)
{
	CS_SET; //选通该片
	HDG_reset();
	delay_ms(5);
	CS_CLR;
	
	HDG_write_cmd(HDG_DISP_ON);
//	HDG_write_cmd(HDG_DISP_REVERSE);//反色
	HDG_write_cmd(HDG_ADC_SELECT_REVERSE);
	delay_ms(1);
	

	HDG_display_str_line("HDG12864F-1 Dv1.0",0,0,5);
	HDG_display_str_line("Driverlib by YinnanZhang",0,1,5);
	HDG_display_str_line("SID:202007020129",0,2,8);
	HDG_display_clr_line(0);
	HDG_display_str_line("Press The Button and See!",0,3,5);
	HDG_display_str_line("LED Init!",5,5,8);
	HDG_display_str_line("POWER ON!",8,7,5);
}

/* @name:HDG_display_ascii
 * @func:原点左上角，向右向下为正，显示一个5*8 ascii字符
 * @para:[ch]待显示字符，[x]列号0~15，[y]行号0~7,[indent]字符纵向间隔像素
 * @desc:页地址对应行0~7
 * @author:Even
**/
void HDG_display_ascii(char ch,uint8_t x,uint8_t y,uint8_t indent)
{
	uint8_t index = (uint8_t) ch;
	uint8_t column_L_addr,column_H_addr;//列地址命令低4位分别存储列地址低、高4位
	uint8_t page_addr;//页（行）地址低4位存储行地址
	
	x*=indent;
	column_L_addr = (x&0x0f)|HDG_COLUNM_ADDR_L;
	column_H_addr = ((x>>4)&0x0f)|HDG_COLUMN_ADDR_H;
	page_addr	  = (y&0x0f)|HDG_PAGE_ADDR;
	
	HDG_write_cmd(page_addr);  		//设置页地址
	HDG_write_cmd(column_H_addr);	//设置列地址的高4位
	HDG_write_cmd(column_L_addr);	//设置列地址的低4位
	
	//加速多个字节传输，可考虑使用DMA
	HDG_write_constant_data(ascii[index],8);
}
/* @name:HDG_display_str_line
 * @func:原点左上角，向右向下为正，显示一个字符串
 * @para:[str]待显示字符串，[x]列号0~15，[y]行号0~7,[indent]字符纵向间隔像素
 * @desc:页地址对应行0~7
 * @author:Even
**/
void HDG_display_str_line(char *str,uint8_t x,uint8_t y,uint8_t indent)
{
	uint8_t i = 0;
	while(str[i]!='\0')
	{
		HDG_display_ascii(str[i],x+i,y,indent);
		i++;
	}
}

/* @name:HDG_display_clr_ch
 * @func:清除一个8*8字符
**/
void HDG_display_clr_ch(uint8_t x,uint8_t y)
{
	uint8_t column_L_addr,column_H_addr;//列地址命令低4位分别存储列地址低、高4位
	uint8_t page_addr;//页（行）地址低4位存储行地址
	
	x*=8;
	column_L_addr = (x&0x0f)|HDG_COLUNM_ADDR_L;
	column_H_addr = ((x>>4)&0x0f)|HDG_COLUMN_ADDR_H;
	page_addr	  = (y&0x0f)|HDG_PAGE_ADDR;
	
	HDG_write_cmd(page_addr);  		//设置页地址
	HDG_write_cmd(column_H_addr);	//设置列地址的高4位
	HDG_write_cmd(column_L_addr);	//设置列地址的低4位

	uint8_t filler[8] = {0,0,0,0,0,0,0,0};

	//加速多个字节传输，可考虑使用DMA
	HDG_write_constant_data(filler,8);
}
/* @name:HDG_display_clr_line
 * @func:清除一行内容
**/
void HDG_display_clr_line(uint8_t y)
{
	uint8_t i = 0;
	for(i = 0;i < 16;i++)
	{
		HDG_display_clr_ch(i,y);
	}
}
